<!DOCTYPE html>
<html>
	 <head>
		 <meta charset="utf-8">
		 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<script type="text/javascript">
	  function annotationTree() {
      $('#annotation-tree').modal();
	  }
	</script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
	<script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
	<script type="text/javascript" src="http://backbonejs.org/backbone-min.js"></script>
	<!-- <script type="text/javascript" src="static/tree.js"></script> -->
	<style type='text/css'>
	  /*#annotation-tree {
	  position:fixed;
	  top:0px;
	  left:0px;
	  width:100%;
	  height:100%;
	  background-color:rgba(0, 0, 0, 0.5);
	  display:none;
	  z-index:99999;
          }*/
  </style>
	<title>Lepakshi Mural</title>
	<meta http-equiv='imagetoolbar' content='no'/>
	<link rel="stylesheet" type="text/css" href="static/bootstrap.css"></link>
	<!--link rel="stylesheet" type="text/css" href="./tree.css"></link-->
	<style type="text/css"> v\:* {behavior:url(#default#VML);}
    label { display: inline;}
	  h1 { margin: 0; padding: 6px; border:0; font-size: 20pt; }
	  #header { height: 43px; padding: 0; background-color: #eee; border: 1px solid #888; }
	  #subheader { height: 12px; text-align: right; font-size: 10px; color: #555;}
	  #map {border: 1px solid #888;}
	</style>
	<script src="http://www.openlayers.org/api/2.11/OpenLayers.js" type="text/javascript"></script>
	<script type="text/javascript" src="static/bootstrap.js"></script>
	<script type="text/javascript" src="static/jit.js"></script>
	<script type="text/javascript" src="static/tree.js"></script>
	<script type="text/javascript" src="static/myVector.js"></script>
	<script type="text/javascript">
	  function treeClose() {
      $('#annotation-tree').modal('hide');
      attribs["character"] =  $("#character-value").text();
      attribs["material"] = $("#material-value").text();
      myJSON.push(attribs);
      $("#publish").attr("disabled", false);
	  }
	</script>
</head>
<body onload="init();">
  <!--div id="header"><h1>Lepakshi Mural</h1></div-->
  <div class="fluid-container">

    <div class="navbar">
      <div class="navbar-inner">
        <a class="brand" href="#">Lepakshi Mural</a>
        <ul class="nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a></a></li>
          <li><a href="#" class="disabled">
            <label><input type="checkbox" name="allow-pan" value="allow-pan" id="allowPanCheckbox" checked=true onclick="allowPan(this);"> Pan</label>
            <!--label for="allowPanCheckbox"><small>allow pan while drawing</small></label-->
          </a></li>
          <li>
            <!--label><input type="radio" name="type" value="none" id="noneToggle" onclick="toggleControl(this);" checked="checked"> Navigate</label-->
            <!--label><input type="radio" name="type" value="box" id="boxToggle" onclick="toggleControl(this);"> Tag</label-->
            <!--label for="noneToggle">navigate</label-->
            <span class="btn-group" data-toggle="buttons-radio">
              <button class="btn active" value="none" id="control-select" onclick="toggleControl(this);" checked="checked">Navigate</button>
              <button class="btn" value="box" id="control-box" onclick="toggleControl(this);">Tag</button>
            </span>
          </li>
          <li><a></a></li>
          <li><a></a></li>
          <li><button class="btn" onClick="publish();" id="publish" disabled="true"/>Publish</button></li>
        </ul>
      </div>
    </div>

    <div id="notification">
    </div>
    <div id="posted" class="alert alert-success" style="display: none; width: 300px; margin: auto;">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <b>Success!</b> Post successfully posted.
    </div>
    <div id="tree-json-loaded" class="alert alert-success" style="display: none; width: 300px; margin: auto;">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <b>Success!</b> New JSON loaded.
    </div>

    <div class="btn-group">
      <button onclick="handler.trigger();"  class="btn btn-small">Mural</button>
      <button onclick="handler.trigger1();" class="btn btn-small"> Face</button>
      <button onclick="handler.trigger2();" class="btn btn-small">Jewellery</button>
    </div>

    <p></p>

    <input type="text" id="tree-json-file" value="old.json">
    <button class="btn" id="load-tree-json" onclick="loadTreeJSON();">Load JSON</button>
    <button class="btn" id="edit-tree-json" onclick="editTreeJSON();">Edit JSON</button>
    <p></p>
    <div id="map"></div>

    <div id="subheader">Generated by <a href="http://www.maptiler.org/">MapTiler</a><a href="http://www.klokan.cz/projects/gdal2tiles/">GDAL2Tiles</a>, Copyright &copy; 2008 <a href="http://www.klokan.cz/">Klokan Petr Pridal</a>,  <a href="http://www.gdal.org/">GDAL</a> &amp; <a href="http://www.osgeo.org/">OSGeo</a> <a href="http://code.google.com/soc/">GSoC</a>
      <!-- PLEASE, LET THIS NOTE ABOUT AUTHOR AND PROJECT SOMEWHERE ON YOUR WEBSITE, OR AT LEAST IN THE COMMENT IN HTML. THANK YOU -->
    </div>

    <div class="edit-json">
      <button id="edit-json-btn" class="btn" onclick="editJSON();">Edit JSON to tweet</button>
      <textarea rows="20" cols="50" id="edit-json" style="display: none;"></textarea>
      <button class="btn" id="save-json" style="display: none;" onclick="saveJSON();">Save</button>
    </div>

  </div>

  <script type="text/javascript" >resize();</script>

  <div id="annotation-tree" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
      <div id="myModalLabel">
        <h3>Annotation attributes</h3>
        <small>Select attributes for annotation</small>
      </div>
    </div>
    <div class="modal-body">
      <div id="infovis"> </div>
      <div id="tree-info" class="well text-info">
        <ul></ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
      <button class="btn btn-primary" onclick="treeClose();">Save changes</button>
    </div>
  </div>

  <script type="text/template" id="tree-info-template">
    <li><b><%= band %></b>: <span id="<%= node %>-value"><%= node %></span></li>
  </script>

	<script type="text/javascript">
    function annotationTree() {
      $('#annotation-tree').modal();
      $('#edit-json').hide();
      $('#edit-json-btn').show();
	  }
    function editJSON() {
      $('#edit-json').show();
      $('#save-json').show();
      $('#edit-json-btn').hide();
      $('#edit-json').val(JSON.stringify(myJSON));
    }
    function saveJSON() {
      $('#edit-json').hide();
      $('#save-json').hide();
      $('#edit-json-btn').show();
      try {
        myJSON = JSON.parse($('#edit-json').val());
      } catch(e) {
        alert('The JSON you entered is invalid. Please try again');
        myJSON = [];
      }
    }
	  function treeClose() {
      $('#annotation-tree').modal('hide');
      $('#tree-info ul li').each(function(idx, elem) {
        var key = $(elem).find('b').text().toLowerCase();
        var val = $(elem).find('span').text().toLowerCase();
        attribs[key] = val;
      });
      myJSON.push(attribs);
      $("#publish").attr("disabled", false);
	  }
    function loadTreeJSON() {
      var file = $('#tree-json-file').val();
      $.getJSON('static/'+file, function(json) {
        ht.loadJSON(json);
        ht.refresh();
        ht.controller.onComplete();
        $('#tree-json-loaded').show();
      });
    }
    function editTreeJSON() {
      var json = $('#tree-json-loaded').val();
      window.open("{{ url_for('editor') }}?json="+json);
    }
	</script>
</body>
</html>
